<script type="text/javascript">
	easyloader.load([], function(){		
		var bd = ebx.cloneObj(ebx.bd);
				
		bd.init('center', function(c, s){
			ebx.setDatagridEditor.editorType(c[0], 'Quantity', 'textbox', {//处理编辑数量时的运算
				onChange: function(newValue, oldValue){
					if(newValue != oldValue){
						var data = s.datagrid('getData'),
							r = s.datagrid('getSelected'),
							index = s.datagrid('getRowIndex', r),
							quantity = ebx.validFloat(newValue),
							TaxRate = ebx.validFloat(data.rows[index].taxrate);
						
						if(data.rows[index] != undefined){
							data.rows[index].aquantity = ebx.validFloat(data.rows[index].relation) * quantity;
							data.rows[index].amount = ebx.validFloat(data.rows[index].price) * quantity;
							if(TaxRate != -1){
								data.rows[index].taxamount = data.rows[index].amount / (TaxRate + 1) * TaxRate;
							}else{
								data.rows[index].taxamount = 0;
							}
							data.rows[index].nat = data.rows[index].amount - data.rows[index].taxamount;
						}
					}
				}
			});
			
			ebx.setDatagridEditor.editorType(c[0], 'price', 'textbox', {//处理编辑数量时的运算
				onChange: function(newValue, oldValue){
					if(newValue != oldValue){
						var data = s.datagrid('getData'),
							r = s.datagrid('getSelected'),
							index = s.datagrid('getRowIndex', r),
							price = ebx.validFloat(newValue),
							TaxRate = ebx.validFloat(data.rows[index].taxrate);
						
						if(data.rows[index] != undefined){
							data.rows[index].amount = ebx.validFloat(data.rows[index].quantity) * price
							if(TaxRate != -1){
								data.rows[index].taxamount = data.rows[index].amount / (TaxRate + 1) * TaxRate;
							}else{
								data.rows[index].taxamount = 0;
							}
							data.rows[index].nat = data.rows[index].amount - data.rows[index].taxamount;
						}
					}
				}
			});
			
			ebx.setDatagridEditor.editorType(c[0], 'amount', 'textbox', {//处理编辑金额时的运算
				onChange: function(newValue, oldValue){
					if(newValue != oldValue){
						var data = s.datagrid('getData'),
							r = s.datagrid('getSelected'),
							index = s.datagrid('getRowIndex', r),
							amount = ebx.validFloat(newValue),
							quantity = ebx.validFloat(data.rows[index].quantity),
							TaxRate = ebx.validFloat(data.rows[index].taxrate);
						
						if(data.rows[index] != undefined){
							if(quantity == 0){
								data.rows[index].price = 0
							}else{
								data.rows[index].price = amount/quantity;
							}
							if(TaxRate != -1){
								data.rows[index].taxamount = data.rows[index].amount / (TaxRate + 1) * TaxRate;
							}else{
								data.rows[index].taxamount = 0;
							}
							data.rows[index].nat = data.rows[index].amount - data.rows[index].taxamount;
						}
					}
				}
			});
		});
	});
</script>
