<script type="text/javascript">
	easyloader.load([], function(){		
		var bd = ebx.cloneObj(ebx.bd);
		bd.init('east', function(c, s){
			ebx.setDatagridEditor.editorMethods(c.rows, 'custom', 'combogrid', {//用来重造客户的combogrid得方法
				onSelect: function(rowIndex, rowData){//选中后更新当前行的内容为选中内容
					var r = s.datagrid('getData').rows;
					for(var i in r){
						if(r[i].field == 'organization'){
							r[i].value = rowData.id;
						}
					}
				}
			});
			
			ebx.setDatagridEditor.editorMethods(c.rows, 'stockname', 'combogrid', {//用来重造仓库的combogrid的方法
				onSelect: function(rowIndex, rowData){//选中后更新当前行的内容为选中内容
					var r = s.datagrid('getData').rows;
					for(var i in r){
						if(r[i].field == 'stock'){
							r[i].value = rowData.id;
						}
					}
				}
			});
			
			ebx.setDatagridEditor.editorMethods(c.rows, 'operatorname', 'combogrid', {//用来重造业务员的combogrid的方法
				onSelect: function(rowIndex, rowData){//选中后更新当前行的内容为选中内容
					var r = s.datagrid('getData').rows;
					for(var i in r){
						if(r[i].field == 'operator'){
							r[i].value = rowData.id;
						}
					}
				}
			});
			
			ebx.setDatagridEditor.editorMethods(c.rows, 'InvoiceTypename', 'combogrid', {//用来重造发票类型的combogrid的方法
				onSelect: function(rowIndex, rowData){//选中后更新当前行的内容为选中内容
					var r = s.datagrid('getData').rows;
					for(var i in r){
						if(r[i].field == 'InvoiceType'){
							r[i].value = rowData.id;
						}
					}
				}
			});
			
			ebx.setDatagridEditor.editorMethods(c.rows, 'VIPCustomname', 'combogrid', {//用来重造会员的combogrid的方法
				onSelect: function(rowIndex, rowData){//选中后更新当前行的内容为选中内容
					var r = s.datagrid('getData').rows;
					for(var i in r){
						if(r[i].field == 'VIPCustomID'){
							r[i].value = rowData.id;
						}
					}
				}
			});
			
			ebx.setDatagridEditor.editorMethods(c.rows, 'Currencyname', 'combogrid', {//用来重造币种的combogrid的方法
				onSelect: function(rowIndex, rowData){//选中后更新当前行的内容为选中内容
					var r = s.datagrid('getData').rows;
					for(var i in r){
						if(r[i].field == 'Currency'){
							r[i].value = rowData.id;
						}
						if(r[i].field == 'Relation'){
							r[i].value = rowData.relation;
							s.datagrid('refreshRow', i);
						}
					}
				}
			});
			
			ebx.setDatagridEditor.editorMethods(c.rows, 'CheckTypename', 'combogrid', {//用来重造结算方式的combogrid的方法
				onSelect: function(rowIndex, rowData){//选中后更新当前行的内容为选中内容
					var r = s.datagrid('getData').rows;
					for(var i in r){
						if(r[i].field == 'CheckType'){
							r[i].value = rowData.id;
						}
					}
				}
			});
			
			ebx.setDatagridEditor.editorMethods(c.rows, 'InvoiceNum', 'textbox', {//用来重造发票好嘛的onClickButton的方法
				onClickButton: function(){//选中后更新当前行的内容为选中内容
					var InvoiceNum = this.value,
						rows = bd.eaststorage.datagrid('getRows'),
						InvoiceType = 0,
						InvoiceMemo = '';
						
					for(var i in rows){
						if(rows[i].field){
							if(rows[i].field.toString().length > 0){
								if(rows[i].field.toLowerCase() === 'invoicetype'){
									InvoiceType = ebx.validInt(rows[i].value);
								}
								if(rows[i].field.toLowerCase() === 'invoicememo'){
									InvoiceMemo = rows[i].value;
								}
							}
						}
					}	
					if(InvoiceType == 0){
						$.messager.alert('错误', '请选择发票类型！', 'error');	
						return;
					};
					if(ebx.validInt(bd.ID) == 0){
						$.messager.show({
							title: '提示',
							msg: '请先保存单据。',
							timeout: 3000,
							showType: 'slide'
						});
						return;
					}
					$.messager.progress({title:'正在保存...',text:''});
					$.ajax({
						type: 'post', 
						url: 'server/SimpChinese/saleoutstock/saveInvoiceNum/',
						data: {id: bd.ID, invoicenum: escape(InvoiceNum),invoicetype: InvoiceType, invoicememo: escape(InvoiceMemo), _:(new Date()).getTime()},
						dataType: "json",
						success: function(result){
							$.messager.progress('close');
							if(result.result){
								$.messager.show({
									title: '提示',
									msg: '发票信息保存成功！',
									timeout: 3000,
									showType: 'slide'
								});
								bd.eaststorage.datagrid('load');
								ebx.setEditstatus(bd.tab, true)
							}else{
								$.messager.alert('错误', '保存失败！' + result.msg, 'error');	
							}
						}
					});
					
				}
			});
			
			ebx.setDatagridEditor.editorMethods(c.rows, 'InvoiceMemo', 'textbox', {//用来重造发票好嘛的onClickButton的方法
				onClickButton: function(){//选中后更新当前行的内容为选中内容
					var InvoiceNum = '',
						rows = bd.eaststorage.datagrid('getRows'),
						InvoiceType = 0,
						InvoiceMemo = this.value;
						
					for(var i in rows){
						if(rows[i].field){
							if(rows[i].field.toString().length > 0){
								if(rows[i].field.toLowerCase() === 'invoicetype'){
									InvoiceType = ebx.validInt(rows[i].value);
								}
								if(rows[i].field.toLowerCase() === 'invoicenum'){
									InvoiceNum = rows[i].value;
								}
							}
						}
					}	
					if(InvoiceType == 0){
						$.messager.alert('错误', '请选择发票类型！', 'error');	
						return;
					};
					if(ebx.validInt(bd.ID) == 0){
						$.messager.show({
							title: '提示',
							msg: '请先保存单据。',
							timeout: 3000,
							showType: 'slide'
						});
						return;
					}
					$.messager.progress({title:'正在保存...',text:''});
					$.ajax({
						type: 'post', 
						url: 'server/SimpChinese/saleoutstock/saveInvoiceNum/',
						data: {id: bd.ID, invoicenum: escape(InvoiceNum),invoicetype: InvoiceType, invoicememo: escape(InvoiceMemo), _:(new Date()).getTime()},
						dataType: "json",
						success: function(result){
							$.messager.progress('close');
							if(result.result){
								$.messager.show({
									title: '提示',
									msg: '发票信息保存成功！',
									timeout: 3000,
									showType: 'slide'
								});
								bd.eaststorage.datagrid('load');
								ebx.setEditstatus(bd.tab, true)
							}else{
								$.messager.alert('错误', '保存失败！' + result.msg, 'error');	
							}
						}
					});
					
				}
			});
		});
	});
</script>