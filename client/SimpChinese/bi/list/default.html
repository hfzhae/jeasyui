<div name="toolbar">
	<select class="easyui-combobox" data-options="panelHeight:'auto',width:'auto'">
		<option action>全部</option>
		<option>已删除</option>
		<option>未删除</option>
	</select>
	<input name="list_searchinput" class="easyui-textbox" data-options="width:120">
	<button name="list_searchbutton" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-ZoomClassic_custom'">搜索</button>
	<span class="datagrid-btn-separator" style="vertical-align: middle;display:inline-block;float:none"></span>
	<button class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-ImportExcel'">导出</button>
	<div name="ExportExcel"></div>
	<span class="datagrid-btn-separator" style="vertical-align: middle;display:inline-block;float:none"></span>
	<div name="new"></div>
</div>
<script type="text/javascript">
	easyloader.load(['datagridscrollview', 'splitbutton', 'menubutton', 'datagridrenderstyler'], function(){
		var tabs = ebx.center.tabs('getSelected'),
			Paramet = ebx.getMenuParameter(tabs),
			layout = tabs.find('.layout'),
			centerpanel = layout.layout('panel', 'center'),
			listdatagrid = $('<div>').appendTo(centerpanel),
			ExportExcelbox = $('<div>'),
			columnsData = [];
			
			ebx.biedit = function(rowIndex, rowData){//打开编辑layout面板函数，参数点击行带入 2018-4-22 zz
				var e,
					id = rowData?rowData.id:'',
					index = rowIndex,
					eastwidth = Paramet.eastwidth!='undefined'?Paramet.eastwidth:400,//获取菜单中编辑面板的宽度参数，默认400
					setEast = function(){
						layout.layout('add',{//添加新的layout
							region: 'east',
							width: eastwidth,
							maxWidth: '50%',
							minWidth: 300,
							title: '',
							href: 'client/SimpChinese/' + e + '/?text='+Paramet.text+'&id=' + id + '&index=' + index,
							hideExpandTool: false,
							hideCollapsedContent: false,
							border: false,
							split: true
						});
					};
					
				if(Paramet.edit == 'undefined' || Paramet.edit == ''){//判断菜单参数
					e = "bi/edit"//如果没有edit参数，赋值默认编辑地址
				}else{
					e = Paramet.edit;//如果有edit参数，赋值参数编辑地址
				}
				
				ebx.EditStatusMessager(tabs.panel('options').editstatus,Paramet.text,function(){
					layout.layout('remove', 'east');//删除编辑layout
					tabs.panel('options').editstatus = false;
					setEast();
				});
			};
			
		ExportExcelbox.menu({
			width:100
		}).menu('appendItem', {
			text: '下载模板',
			iconCls:'icon-FileSaveAsExcelXlsx'
		});
		
		centerpanel.find('div[name=ExportExcel]').splitbutton({
			iconCls: 'icon-ExportExcel',
			text:'导入',
			menu: ExportExcelbox
		});
		
		centerpanel.find('div[name=new]').linkbutton({
			text:'新建',
			iconCls:'icon-file',
			onClick:ebx.biedit
		}).addClass('l-btn-plain');

		$.ajax({
			type: 'post', 
			url: 'server/bi/style/?_=' + (new Date()).getTime(),
			data: JSON.stringify(ebx.EscapeJson(Paramet)), //可选参数
			//data:'{"style":"stock","obj":[{"c":"c","d":{"e":"e"}},{"f":"f"}]}',
			dataType: "json",
			success: function(result){
				if(result){
					columnsData = [ebx.UnescapeJson(result.data)];//转码所有嵌套json中文的escape
					listdatagrid.datagrid({
						view:scrollview,
						pageSize:ebx.pagesize,
						remoteSort:false,
						rownumbers:true,
						singleSelect:true,
						pagination:false,
						border:false,
						fit:false,
						fitColumns:false,
						striped:true,
						url:'server/bi/list/',
						method:'post',
						queryParams:{template:Paramet.template,_:(new Date()).getTime()},
						toolbar:centerpanel.find('div[name=toolbar]'),
						multiSort:false,
						checkOnSelect:false,
						columns:columnsData,
						height: '100%',
						onClickRow: ebx.biedit
					}).datagrid('renderformatterstyler');
				}
			}
		});
		
		centerpanel.find('button[name=list_searchbutton]').on('click', function(){//点击搜索按钮
			var find = escape(centerpanel.find('input[name=list_searchinput]').val());
			searchsend(find);
		});
				
		centerpanel.find('input[name=list_searchinput]').parent().on('keydown', function(e){//搜索框回车事件
			if(e.keyCode == 13) {
				var find = escape(centerpanel.find('input[name=list_searchinput]').val());
				searchsend(find);
			}
		});
		
		centerpanel.find('input[name=list_searchinput]').prev().focus(function(){//搜索框激活焦点后自动全选文本
			this.select();
		});
		
		function searchsend(s){//搜索函数
			listdatagrid.datagrid('load', {
				template:Paramet.template,
				_:(new Date()).getTime(),
				find: s
			});
		}
	});
</script>