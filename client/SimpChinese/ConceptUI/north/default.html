<div id="north"></div>
<script type="text/javascript">
	easyloader.load('menubutton', function(){
		$('#north')
		.append('<div class="hometitle">e商x</div>')
		.append('<div class="homeversion">v0.1 Design by zydsoft™</div>');
		
		var setupbtn = $('<div>').appendTo($('#north')),
			setupmenu = $('<div>').appendTo($('#north')),
			themesmenuDiv = $('<div>').appendTo($('#north')),
			deltabs = $('<div>').appendTo($('#north'));
			
		var theme = ebx.storage.get("themes").theme;	
		
		deltabs.linkbutton({
			plain:true,
			iconCls:'icon-DeclineInvitationNull',
			onClick: function(){
				var arrTitle = new Array(),
					centertabs = ebx.center.tabs("tabs"),
					tCount = centertabs.length,
					index = ebx.center.tabs('getTabIndex',ebx.center.tabs('getSelected'));
					
				if(tCount>0){
					/*					
					for(var i=0;i<tCount;i++){
						if(centertabs[i].panel('options').closable){//获取可删除tab的index
							arrTitle.push(centertabs[i].panel('options').index);
						}
					}

					for(var i = arrTitle.length - 1; i >= 0; i--){//循环删除tab
						ebx.center.tabs("close", arrTitle[i]); 
					}
					*/
					if(centertabs[index].panel('options').closable){//获取可删除tab的index
						ebx.center.tabs("close", index); 
					}
				}  
			}
		}).addClass('homedelbtn');
		
		setupmenu.menu({
			onClick: function(item){
				if($('#tabs_'+item.id).length > 0){
					$('#center').tabs('select', $('#tabs_'+item.id).panel('options').index);
				}else{

					$('#center').tabs('add',{
						id:'tabs_'+item.id,
						title:item.text,
						href:'public.html',
						iconCls:item.iconCls,
						selected: true,
						closable:true
					});
					$('#tabs_'+item.id).css({padding:10});
				}
			}
		})
		.menu('appendItem', {
			id:'setup_menu_01',
			text: '个性设置',
			iconCls:''
		})
		.menu('appendItem', {
			separator: true
		})
		.menu('appendItem', {
			id:'setup_menu_02',
			text: '修改密码',
			iconCls:'icon-AdpPrimaryKey'
		})
		.menu('appendItem', {
			id:'setup_menu_03',
			text: '修改个人信息',
			iconCls:'icon-NewContact'
		})
		.menu('appendItem', {
			id:'setup_menu_04',
			text: '切换主题',
			menu: themesmenuDiv
		})
		.menu('appendItem', {
			separator: true
		})
		.menu('appendItem', {
			id:'setup_menu_05',
			text: '关于e商',
			iconCls:'icon-AdvertisePublishAs'
		})
		.menu('appendItem', {
			id:'setup_menu_06',
			text: '注销',
			iconCls:''
		});
		
		setupbtn.menubutton({
			iconCls: 'icon-ControlsGallery',
			menu: setupmenu
		}).addClass('hometitlethemesbtn');
		
		setupbtn.find('.m-btn-downarrow').remove();
		setupbtn.find('.l-btn-empty').css({'marginRight':4,'marginLeft':4});
		
		setupmenu.menu('appendItem', {
			parent:setup_menu_04,
			text: 'default',
			iconCls:(theme=='default'?'icon-ok':''),
			onclick: function(){setThemes('default', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'black',
			iconCls:(theme=='black'?'icon-ok':''),
			onclick: function(){setThemes('black', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'bootstrap',
			iconCls:(theme=='bootstrap'?'icon-ok':''),
			onclick: function(){setThemes('bootstrap', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'gray',
			iconCls:(theme=='gray'?'icon-ok':''),
			onclick: function(){setThemes('gray', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'material',
			iconCls:(theme=='material'?'icon-ok':''),
			onclick: function(){setThemes('material', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'metro',
			iconCls:(theme=='metro'?'icon-ok':''),
			onclick: function(){setThemes('metro', this)}
		})
		.menu('appendItem', {
			parent:setup_menu_04,
			text: 'metro-blue',
			iconCls:(theme=='metro-blue'?'icon-ok':''),
			onclick: function(){setThemes('metro-blue', this)}
		})
		.menu('appendItem', {
			parent:setup_menu_04,
			text: 'metro-gray',
			iconCls:(theme=='metro-gray'?'icon-ok':''),
			onclick: function(){setThemes('metro-gray', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'metro-green',
			iconCls:(theme=='metro-green'?'icon-ok':''),
			onclick: function(){setThemes('metro-green', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'metro-orange',
			iconCls:(theme=='metro-orange'?'icon-ok':''),
			onclick: function(){setThemes('metro-orange', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'metro-red',
			iconCls:(theme=='metro-red'?'icon-ok':''),
			onclick: function(){setThemes('metro-red', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'ui-cupertino',
			iconCls:(theme=='ui-cupertino'?'icon-ok':''),
			onclick: function(){setThemes('ui-cupertino', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'ui-dark-hive',
			iconCls:(theme=='ui-dark-hive'?'icon-ok':''),
			onclick: function(){setThemes('ui-dark-hive', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'ui-pepper-grinder',
			iconCls:(theme=='ui-pepper-grinder'?'icon-ok':''),
			onclick: function(){setThemes('ui-pepper-grinder', this)}
		}).menu('appendItem', {
			parent:setup_menu_04,
			text: 'ui-sunny',
			iconCls:(theme=='ui-sunny'?'icon-ok':''),
			onclick: function(){setThemes('ui-sunny', this)}
		});

		function setThemes(t, o){
			var oldthemes = ebx.getThemes(),
				linkobj = document.getElementsByTagName("link"),
				loaddiv = $('<div style="display:none;">').appendTo('body');
			
			if(oldthemes == t){
				return;
			}
			//$.messager.progress({title:'主题切换中...',interval:50, msg: '正在下载主题文件'}); 
			$.messager.progress({title:'主题切换中...',interval:50}); 
			
			for(var i in linkobj){
				if(typeof(linkobj[i].href) == 'string'){
					var url = linkobj[i].href;
					if(url.indexOf(oldthemes) >= 0){
						var arr = url.split(oldthemes);
						loaddiv.load(arr[0] + t + arr[1]);
					}
				}
			}
			
			setTimeout(function(){
				ebx.storage.set('themes', {theme: t});
				for(var i in linkobj){
					if(typeof(linkobj[i].href) == 'string'){
						var url = linkobj[i].href;
						if(url.indexOf(oldthemes) >= 0){
							var arr = url.split(oldthemes);
							linkobj[i].setAttribute("href", arr[0] + t + arr[1]);
						}
					}
				}
				easyloader.theme = ebx.getThemes();
				$('body').find('.menu').find('.icon-ok').remove();
				$(o).append('<div class="menu-icon icon-ok"></div>');
				$.messager.progress('close');
				$.messager.show({
					title: '提示',
					msg: '主题已切换为：' + t,
					height:100,
					timeout: 3000,
					showType: 'slide'
				});	

			}, 500);
		}
	});
</script>
